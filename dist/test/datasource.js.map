{"version":3,"sources":["../../src/datasource.js"],"names":["GenericDatasource","instanceSettings","$q","backendSrv","templateSrv","type","url","name","projectName","jsonData","project","logstore","user","password","q","withCredentials","headers","basicAuth","length","defaultConfig","accessId","accessKey","timeout","signature_method","api_version","logger","options","console","log","requests","slsclient","promise","Promise","resolve","targets","forEach","target","hide","request","GetData","parseInt","range","from","_d","getTime","to","replace","query","then","result","data","Data","reject","Error","time_col","xcol","ycol","reduce","split","join","push","resResult","table","_time","time","value","datapoints","count","sortBy","col","parseFloat","all","map","p","catch","e","_t","t","err","message","status","title","Date","annotation","annotationQuery","datasource","enable","iconColor","rangeRaw","doRequest","method","interpolated","mapToTextValue","d","i","text","isObject","datasourceRequest","filter","scopedVars","refId"],"mappings":"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","file":"datasource.js","sourcesContent":["import _ from \"lodash\";\nimport {SLS} from \"./sls.js\";\n\nexport class GenericDatasource {\n    constructor(instanceSettings, $q, backendSrv, templateSrv) {\n        this.type = instanceSettings.type;\n        this.url = instanceSettings.url;\n        this.name = instanceSettings.name;\n        this.projectName = instanceSettings.jsonData.project;\n        this.logstore = instanceSettings.jsonData.logstore;\n        //this.endpoint = instanceSettings.jsonData.endpoint;\n        this.user = instanceSettings.jsonData.user;\n        this.password = instanceSettings.jsonData.password;\n        this.q = $q;\n        this.backendSrv = backendSrv;\n        this.templateSrv = templateSrv;\n        this.withCredentials = instanceSettings.withCredentials;\n        this.headers = {'Content-Type': 'application/json'};\n        if (typeof instanceSettings.basicAuth === 'string' && instanceSettings.basicAuth.length > 0) {\n            this.headers['Authorization'] = instanceSettings.basicAuth;\n        }\n        this.defaultConfig = {\n\n            //requires\n            accessId: this.user,                  //accessId\n            accessKey: this.password,                 //accessKey\n            //endpoint: this.endpoint,            //sls service endpoint\n\n            //optional\n            timeout: 20000,         //请求timeout时间, 默认: 20s\n\n\n            signature_method: 'hmac-sha1', //签名计算方式，目前只支持'hmac-sha1', 默认: 'hmac-sha1'\n            api_version: '0.3.0',  //数据相关api version 默认 0.3.0\n\n            logger: false   //打印请求的详细信息, log4js 实例\n        };\n\n    }\n\n    query(options) {\n        console.log(\"hello\")\n        let requests = []\n        let slsclient = new SLS(this.defaultConfig, this.backendSrv, this.url);\n        let promise = Promise.resolve();\n        _(options.targets).forEach(target => {\n            if (target.hide) {\n                return\n            }\n            let request = slsclient.GetData(this.projectName, {\n                \"Category\": this.logstore,\n                \"Topic\": \"\",\n                \"BeginTime\": parseInt(options.range.from._d.getTime() / 1000),\n                \"EndTime\": parseInt(options.range.to._d.getTime() / 1000),\n                \"Query\": this.templateSrv.replace(target.query, {}, 'glob'),\n                \"Reverse\": \"false\",\n                \"Lines\": \"100\",\n                \"Offset\": \"0\"\n            })\n                .then(result => {\n                    if (!(result.data && result.data.GetData && result.data.GetData.Data)) {\n                        return Promise.reject(new Error(\"this promise is rejected\"));\n                    }\n\n                    result.time_col = target.xcol\n                    result.ycol = _.reduce(target.ycol.split(\",\"), (result, data) => {\n                        data = data.split(' ').join('')\n                        if (data) {\n                            result.push(data)\n                        }\n                        return result\n                    }, [])\n                    return result\n                })\n                .then(result => {\n\n                    console.log(\"test\")\n                    let resResult = []\n                    let table = false\n\n                    if (result.time_col === \"pie\") {\n                        _(result.data.GetData.Data, [result.ycol[0]]).forEach(data => {\n                            const _time = data[\"__time__\"]\n                            const time = parseInt(_time) * 1000\n                            const value = parseInt(data[result.ycol[1]])\n                            resResult.push({\n                                \"target\": data[result.ycol[0]],\n                                \"datapoints\": [[value, time]]\n                            })\n\n                        })\n                        return resResult\n                    }\n                    if (result.time_col === \"table\") {\n                        table = true\n                    }\n                    _(result.ycol).forEach(col => {\n                        let datapoints = []\n                        let count = 0\n                        _.sortBy(result.data.GetData.Data, [result.time_col]).forEach(data => {\n                            const _time = data[result.time_col]\n                            if (table) {\n                                const time = count\n                                count -= 1\n                                const value = data[col]\n                                datapoints.push([value, time])\n                            }\n                            else {\n                                const time = parseFloat(_time) * 1000\n                                const value = parseFloat(data[col])\n                                datapoints.push([value, time])\n\n                            }\n\n                        })\n                        resResult.push({\n                            \"target\": col,\n                            \"datapoints\": datapoints\n                        })\n\n                    })\n                    return resResult\n\n                });\n            requests.push(request)\n\n        })\n\n        return Promise.all(requests\n            .map(p => p.catch(e => e)))\n            .then(requests => {\n                console.log(\"1:\", requests)\n\n                const _t = _.reduce(requests, (result, data) => {\n                    _(data).forEach(t => result.push(t))\n                    return result\n                }, [])\n                console.log(\"1:\", _t)\n                return {\n                    data: _t\n                }\n\n            }) // 1,Error: 2,3\n            .catch(err => {\n                if (err.data && err.data.message) {\n                    return {status: \"error\", message: err.data.message, title: \"Error\"};\n                } else {\n                    return {status: \"error\", message: err.status, title: \"Error\"};\n                }\n            });\n    }\n\n    testDatasource() {\n        let slsclient = new SLS(this.defaultConfig, this.backendSrv, this.url);\n        return slsclient.GetData(this.projectName,\n            {\n                \"Category\": this.logstore,\n                \"Topic\": \"\",\n                \"BeginTime\": parseInt((new Date().getTime() / 1000) - 900),\n                \"EndTime\": parseInt(new Date().getTime() / 1000),\n                \"Query\": \"\",\n                \"Reverse\": \"false\",\n                \"Lines\": \"10\",\n                \"Offset\": \"0\"\n            }).then(function (result) {\n\n            return {status: \"success\", message: \"Database Connection OK\", title: \"Success\"};\n        }, function (err) {\n            console.log(\"testDataSource err\", err);\n            if (err.data && err.data.message) {\n                return {status: \"error\", message: err.data.message, title: \"Error\"};\n            } else {\n                return {status: \"error\", message: err.status, title: \"Error\"};\n            }\n\n        });\n\n\n    }\n\n    annotationQuery(options) {\n        let query = this.templateSrv.replace(options.annotation.query, {}, 'glob');\n        let annotationQuery = {\n            range: options.range,\n            annotation: {\n                name: options.annotation.name,\n                datasource: options.annotation.datasource,\n                enable: options.annotation.enable,\n                iconColor: options.annotation.iconColor,\n                query: query\n            },\n            rangeRaw: options.rangeRaw\n        };\n\n        return this.doRequest({\n            url: this.url + '/annotations',\n            method: 'POST',\n            data: annotationQuery\n        }).then(result => {\n            return result.data;\n        });\n    }\n\n    metricFindQuery(query) {\n\n        let interpolated = {\n            target: this.templateSrv.replace(query, null, 'regex')\n        };\n\n        return this.doRequest({\n            url: this.url + '/search',\n            data: interpolated,\n            method: 'POST',\n        }).then(this.mapToTextValue);\n    }\n\n    mapToTextValue(result) {\n        return _.map(result.data, (d, i) => {\n            if (d && d.text && d.value) {\n                return {text: d.text, value: d.value};\n            } else if (_.isObject(d)) {\n                return {text: d, value: i};\n            }\n            return {text: d, value: d};\n        });\n    }\n\n    doRequest(options) {\n        options.withCredentials = this.withCredentials;\n        options.headers = this.headers;\n\n        return this.backendSrv.datasourceRequest(options);\n    }\n\n    buildQueryParameters(options) {\n        //remove placeholder targets\n        options.targets = _.filter(options.targets, target => {\n            return target.target !== 'select metric';\n        });\n\n        let targets = _.map(options.targets, target => {\n            return {\n                target: this.templateSrv.replace(target.target, options.scopedVars, 'regex'),\n                refId: target.refId,\n                hide: target.hide,\n                type: target.type || 'timeserie'\n            };\n        });\n\n        options.targets = targets;\n\n        return options;\n    }\n}\n"]}