{"version":3,"sources":["../../src/sls.js"],"names":["SLS","config","backendSrv","url","mt","uri","hd","bd","fn","timeout","toUpperCase","Date","toGMTString","api_version","accessId","signature_method","sortStr","getSortParamStr","signature","signFn","encodeURIComponent","vurl","datasourceRequest","method","header","ProjectName","opt","Project","requestData","str","b64_hmac_sha1","accessKey","k","d","_p","_z","console","log","_f","t","b","c","_k","_s","x","y","l","m","_r","n","_c","w","a","e","i","length","o","p","q","r","s","j","_b","charCodeAt","_h","h","concat","_n","charAt","_x","obj","flag","APIVersion","push","sort","join","hostname","replace","v","endpoint","host"],"mappings":"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","file":"sls.js","sourcesContent":["export class SLS{\n    constructor(config,backendSrv,url)\n    {\n        this.config = config;\n        this.backendSrv = backendSrv;\n        this.url = url;\n    }\n    requestData (mt, uri, hd, bd, fn, timeout) {\n        var config = this.config;\n\n        mt = mt.toUpperCase();\n\n        bd = bd || {};\n        bd['Date'] = new Date().toGMTString();\n        bd['APIVersion'] = config.api_version || '0.3.0';\n        bd['AccessKeyId'] = config.accessId;\n        bd['SignatureMethod'] = config.signature_method;\n        hd['User-Agent']=\"slsweb\";\n\n\n        var sortStr = this.getSortParamStr(bd);\n\n        var signature = this.signFn( uri + '\\n' + sortStr);\n\n        var url = uri + '?' + this.getSortParamStr(bd, true) + '&Signature=' + encodeURIComponent(signature);\n\n        var vurl = this.url + url;\n\n        return this.backendSrv.datasourceRequest(\n                {  url : vurl,\n                method:\"GET\",\n                header: hd\n                }\n                );\n    }\n    GetData(ProjectName, opt, fn) {\n        opt.Project = ProjectName;\n        return this.requestData('GET', '/GetData', {}, opt, fn);\n    }\n    signFn(str)\n    {\n        return this.b64_hmac_sha1(this.config.accessKey,str);\n    }\n    b64_hmac_sha1(k,d,_p,_z){\n        console.log(k,d);\n        // heavily optimized and compressed version of http://pajhome.org.uk/crypt/md5/sha1.js\n        // _p = b64pad, _z = character size; not used here but I left them available just in case\n        if(!_p){_p='=';}if(!_z){_z=8;}function _f(t,b,c,d){if(t<20){return(b&c)|((~b)&d);}if(t<40){return b^c^d;}if(t<60){return(b&c)|(b&d)|(c&d);}return b^c^d;}function _k(t){return(t<20)?1518500249:(t<40)?1859775393:(t<60)?-1894007588:-899497514;}function _s(x,y){var l=(x&0xFFFF)+(y&0xFFFF),m=(x>>16)+(y>>16)+(l>>16);return(m<<16)|(l&0xFFFF);}function _r(n,c){return(n<<c)|(n>>>(32-c));}function _c(x,l){x[l>>5]|=0x80<<(24-l%32);x[((l+64>>9)<<4)+15]=l;var w=[80],a=1732584193,b=-271733879,c=-1732584194,d=271733878,e=-1009589776;for(var i=0;i<x.length;i+=16){var o=a,p=b,q=c,r=d,s=e;for(var j=0;j<80;j++){if(j<16){w[j]=x[i+j];}else{w[j]=_r(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);}var t=_s(_s(_r(a,5),_f(j,b,c,d)),_s(_s(e,w[j]),_k(j)));e=d;d=c;c=_r(b,30);b=a;a=t;}a=_s(a,o);b=_s(b,p);c=_s(c,q);d=_s(d,r);e=_s(e,s);}return[a,b,c,d,e];}function _b(s){var b=[],m=(1<<_z)-1;for(var i=0;i<s.length*_z;i+=_z){b[i>>5]|=(s.charCodeAt(i/8)&m)<<(32-_z-i%32);}return b;}function _h(k,d){var b=_b(k);if(b.length>16){b=_c(b,k.length*_z);}var p=[16],o=[16];for(var i=0;i<16;i++){p[i]=b[i]^0x36363636;o[i]=b[i]^0x5C5C5C5C;}var h=_c(p.concat(_b(d)),512+d.length*_z);return _c(o.concat(h),512+160);}function _n(b){var t=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",s='';for(var i=0;i<b.length*4;i+=3){var r=(((b[i>>2]>>8*(3-i%4))&0xFF)<<16)|(((b[i+1>>2]>>8*(3-(i+1)%4))&0xFF)<<8)|((b[i+2>>2]>>8*(3-(i+2)%4))&0xFF);for(var j=0;j<4;j++){if(i*8+j*6>b.length*32){s+=_p;}else{s+=t.charAt((r>>6*(3-j))&0x3F);}}}return s;}function _x(k,d){return _n(_h(k,d));}return _x(k,d);\n    }\n    getSortParamStr (obj, flag) {\n        var t = [];\n        if (flag) {\n            for (var k in obj) {\n                if (k=='protobuf'|| obj.APIVersion >= '0.3.0' && k == 'Project')continue;\n                t.push(k + '=' + encodeURIComponent(obj[k]));\n            }\n        }\n        else {\n            for (var k in obj) {\n                if (k=='protobuf' || obj.APIVersion >= '0.3.0' && k == 'Project')continue;\n                t.push(k + '=' + obj[k]);\n            }\n        }\n        t.sort();\n        return t.join('&');\n    }\n    getRealEndPoint (url, obj){\n\n        //test\n        //return {endpoint:  'http://service.sls-stg.aliyun-inc.com:179/', host: '44.sls-stg.aliyun-inc.com:179'};\n        var hostname = url.replace(\"http://\",\"\");\n        var v = url.replace(\"http://\",\"\");\n        return {endpoint:\"http://\"+obj[\"Project\"]+\".\"+v,host: hostname};\n    };\n\n}\n"]}